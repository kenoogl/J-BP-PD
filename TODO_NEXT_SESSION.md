# æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å®Ÿæ–½ã™ã‚‹ä½œæ¥­

## ğŸ“ ç¾åœ¨ã®çŠ¶æ…‹

### âœ… å®Œäº†ã—ãŸãƒ•ã‚§ãƒ¼ã‚º

#### ãƒ•ã‚§ãƒ¼ã‚º1: Jensenä¸­å¿ƒç·šãƒ•ã‚£ãƒƒãƒˆä¿®æ­£ï¼ˆå®Œäº†ï¼‰
- 2ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚£ãƒƒãƒˆ `[kw, Ct_eff]` ã¸ã®å¤‰æ›´
- æ®‹å·®99.6%æ”¹å–„ï¼ˆ0.732 â†’ 0.003ï¼‰
- å…¨31ã‚±ãƒ¼ã‚¹ãŒé–¾å€¤ä»¥å†…ã«åã¾ã‚‹

#### ãƒ•ã‚§ãƒ¼ã‚º2: ä¿‚æ•°å›å¸°ãƒ¢ãƒ‡ãƒ«æ›´æ–°ï¼ˆå®Œäº†ï¼‰
- `coefficients_two_region(I, Ct)` é–¢æ•°ã‚’å®Ÿè£…
- 6ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å›å¸°åˆ†æå®Œäº†
- 5/6ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§RÂ²>0.94é”æˆ

**å›å¸°ç²¾åº¦ã‚µãƒãƒªãƒ¼**:
```
Parameter   | RÂ²     | RMSE   | è©•ä¾¡
------------|--------|--------|------
Ct_eff      | 0.945  | 0.021  | âœ“
sigmaJ0     | 0.942  | 0.002  | âœ“
sigmaG0     | 0.976  | 0.006  | âœ“
km          | 0.972  | 0.001  | âœ“
kw          | 0.858  | 0.006  | â—‹
x_shift     | 0.467  | 2.024  | â–³
```

### ğŸ“‚ ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ‡ãƒ¼ã‚¿**:
- `fit_coefficients_summary.csv` - 31ã‚±ãƒ¼ã‚¹ã€23ã‚«ãƒ©ãƒ 
  - æ–°ã‚«ãƒ©ãƒ : kw, Ct_eff, sigmaJ0, sigmaG0, km, x_shift

**ãƒ¢ãƒ‡ãƒ«**:
- `src/coeff_model.jl` - ä¿‚æ•°å›å¸°ãƒ¢ãƒ‡ãƒ«
  - `coefficients_two_region(I, Ct)` - æ–°ãƒ¢ãƒ‡ãƒ«
  - `coefficients_from_IC(I, Ct)` - æ—§ãƒ¢ãƒ‡ãƒ«ï¼ˆå¾Œæ–¹äº’æ›ï¼‰

**ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:
- `src/fit_gaussian_wake.jl` - CFDãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡º
- `src/compute_regression_coeffs.jl` - å›å¸°ä¿‚æ•°è¨ˆç®—
- `src/test_coeff_model.jl` - ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚¹ãƒˆ

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- `JensenBastankhah_Plan.md` - é–‹ç™ºè¨ˆç”»ã¨ä½œæ¥­ãƒ­ã‚°
- `CHANGELOG.md` - å¤‰æ›´å±¥æ­´
- `FigGaussPD.md` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®èª¬æ˜

## ğŸ¯ æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ï¼ˆãƒ•ã‚§ãƒ¼ã‚º3ï¼‰

### 1. plot_reconstructed_wake.jl ã®äºŒé ˜åŸŸå†æ§‹æˆå®Ÿè£…

#### å®Ÿè£…ã™ã¹ãæ©Ÿèƒ½
```julia
# Jensené ˜åŸŸ (x < x_shift)
Î”U/Uâˆ = 1 - âˆš{1 - Ct_eff/(1 + 2*kw*x)Â²}
Ïƒ(x) = sigmaJ0 + 2*kw*x

# Bastankhahé ˜åŸŸ (x â‰¥ x_shift)
Î”U/Uâˆ = 1 - âˆš{1 - Ct_eff/(8*(Ïƒ/D)Â²)}
Ïƒ(x) = sigmaG0 + km*(x - x_shift)
```

#### CLIã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `--two-region` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ): æ–°ã—ã„äºŒé ˜åŸŸãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨
- `--single-gauss`: æ—§ãƒ¢ãƒ‡ãƒ«ã¨ã®æ¯”è¼ƒç”¨
- `--all`: å…¨ã‚±ãƒ¼ã‚¹å‡¦ç†
- `--summary`: CSVå®Ÿæ¸¬å€¤ã‚’ä½¿ç”¨ï¼ˆå›å¸°ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã‚ãªã„ï¼‰

#### å¯è¦–åŒ–è¦ç´ 
- æ¥ç¶šä½ç½®ï¼ˆx_shiftï¼‰ã‚’å›³ã«è¡¨ç¤º
- Jensené ˜åŸŸã¨Bastankhahé ˜åŸŸã‚’è‰²åˆ†ã‘
- Ïƒ(x)ã®æ¨ç§»ãƒ—ãƒ­ãƒƒãƒˆ
- ä¸­å¿ƒç·šé€Ÿåº¦æ¬ æã®æ¯”è¼ƒ

### 2. æ¤œè¨¼ã‚·ãƒŠãƒªã‚ª

#### å…¨ã‚±ãƒ¼ã‚¹æ¤œè¨¼
```bash
julia --project=. src/plot_reconstructed_wake.jl --all --two-region
```

**è¨ˆç®—ã™ã¹ãæŒ‡æ¨™**:
- è¿‘æ¥åŸŸï¼ˆx/D < 2ï¼‰: L2èª¤å·®ã€æœ€å¤§èª¤å·®ã€å¹³å‡ç›¸å¯¾èª¤å·®
- é·ç§»åŸŸï¼ˆ2 â‰¤ x/D â‰¤ 5ï¼‰: åŒä¸Š
- é æ–¹åŸŸï¼ˆx/D > 5ï¼‰: åŒä¸Š
- çµæœã‚’ `figures/recon_metrics.csv` ã«ä¿å­˜

#### æ¯”è¼ƒè©•ä¾¡
```bash
# æ—§ãƒ¢ãƒ‡ãƒ«
julia --project=. src/plot_reconstructed_wake.jl --all --single-gauss

# æ–°ãƒ¢ãƒ‡ãƒ«
julia --project=. src/plot_reconstructed_wake.jl --all --two-region
```

æ”¹å–„ç‡ã‚’è¨ˆç®—ã—ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜éŒ²

#### å¤–æŒ¿ãƒ†ã‚¹ãƒˆ
ç¯„å›²å¤–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆ:
- (I=0.35, C=18)
- (I=0.005, C=25)
- (I=0.20, C=8)

çµæœã‚’ `figures/extrapolation/` ã«ä¿å­˜

### 3. å®Ÿè£…ã®æ‰‹é †

#### ã‚¹ãƒ†ãƒƒãƒ—1: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª
```bash
# ç¾åœ¨ã®plot_reconstructed_wake.jlã‚’èª­ã‚€
cat src/plot_reconstructed_wake.jl
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: äºŒé ˜åŸŸé–¢æ•°ã®è¿½åŠ 
- `compute_jensen_deficit(x, kw, Ct_eff)` é–¢æ•°
- `compute_bastankhah_deficit(x, sigma, Ct_eff)` é–¢æ•°
- `compute_two_region_wake(x, r, params)` é–¢æ•°

#### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®å‡¦ç†
- `--two-region` / `--single-gauss` ã®å®Ÿè£…
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã®è¨­å®š

#### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°
```bash
# å˜ä¸€ã‚±ãƒ¼ã‚¹ã§ãƒ†ã‚¹ãƒˆ
julia --project=. src/plot_reconstructed_wake.jl 0.05 16 --two-region

# å…¨ã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
julia --project=. src/plot_reconstructed_wake.jl --all --two-region
```

## ğŸ“‹ äºˆæƒ³ã•ã‚Œã‚‹èª²é¡Œã¨å¯¾å‡¦æ³•

### èª²é¡Œ1: x_shiftã§ã®ä¸é€£ç¶š
**å•é¡Œ**: Jensené ˜åŸŸã¨Bastankhahé ˜åŸŸã®æ¥ç¶šç‚¹ã§é€Ÿåº¦ã‚„å‹¾é…ãŒä¸é€£ç¶šã«ãªã‚‹å¯èƒ½æ€§

**å¯¾å‡¦æ³•**:
- æ¥ç¶šç‚¹ã§Î”Uã¨dÎ”U/dxã‚’ä¸€è‡´ã•ã›ã‚‹è£œæ­£ä¿‚æ•°ã‚’å°å…¥
- å¿…è¦ã«å¿œã˜ã¦Ïƒã®åˆæœŸå€¤ã‚’èª¿æ•´

### èª²é¡Œ2: x_shiftã®å›å¸°ç²¾åº¦ãŒä½ã„
**å•é¡Œ**: RÂ²=0.47ã¨ç²¾åº¦ãŒä½ãã€äºˆæ¸¬å€¤ãŒã°ã‚‰ã¤ãå¯èƒ½æ€§

**å¯¾å‡¦æ³•**:
- x_shift < 0.5ã®å ´åˆã¯0.5ã«å›ºå®š
- x_shift > 10ã®å ´åˆã¯10ã«å›ºå®š
- ãƒ­ã‚°ã«è­¦å‘Šã‚’å‡ºåŠ›

### èª²é¡Œ3: kwãŒ0ã«è¿‘ã„ã‚±ãƒ¼ã‚¹
**å•é¡Œ**: ä½Ié ˜åŸŸã§kwâ‰ˆ0ã¨ãªã‚Šã€Jensené ˜åŸŸãŒå¹³å¦ã«ãªã‚‹

**å¯¾å‡¦æ³•**:
- kw < 0.001ã®å ´åˆã¯å®šæ•°æ¬ æãƒ¢ãƒ‡ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆ
- ã¾ãŸã¯ç›´æ¥Bastankhahãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨

## ğŸ”§ ãƒ‡ãƒãƒƒã‚°ã®ãƒ’ãƒ³ãƒˆ

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

1. **"DomainError: sqrt will only return a complex result"**
   - Ct_eff/(1+2*kw*x)Â² > 1 ã®å ´åˆã«ç™ºç”Ÿ
   - clamp(value, 0, 0.99)ã§åˆ¶ç´„

2. **"ArgumentError: range step cannot be zero"**
   - x_shiftãŒç¯„å›²å¤–ã®å ´åˆã«ç™ºç”Ÿ
   - max(x_shift, 0.5)ã§åˆ¶ç´„

3. **ä¸é€£ç¶šãªé€Ÿåº¦åˆ†å¸ƒ**
   - æ¥ç¶šç‚¹ã®å‡¦ç†ã‚’ç¢ºèª
   - Ïƒã®é€£ç¶šæ€§ã‚’ãƒã‚§ãƒƒã‚¯

## ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã‚¿ã‚¹ã‚¯

ãƒ•ã‚§ãƒ¼ã‚º3å®Œäº†å¾Œ:
1. `JensenBastankhah_Plan.md` ã«ãƒ•ã‚§ãƒ¼ã‚º3ã®çµæœã‚’è¿½è¨˜
2. `CHANGELOG.md` ã‚’æ›´æ–°
3. `FigGaussPD.md` ã®å‡ºåŠ›ç‰©ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
4. ä»£è¡¨çš„ãª3ã‚±ãƒ¼ã‚¹ã®å›³ã‚’é¸ã³ã€è¨ˆç”»æ›¸ã«æ²è¼‰

## ğŸš€ é–‹å§‹ã‚³ãƒãƒ³ãƒ‰

```bash
cd /Users/Daily/Development/WindTurbineWake/FitGauss-PD

# ç¾çŠ¶ç¢ºèª
git status
git log --oneline -5

# æ—¢å­˜ã‚³ãƒ¼ãƒ‰ç¢ºèª
cat src/plot_reconstructed_wake.jl | head -100

# ä½œæ¥­é–‹å§‹
# TODO: plot_reconstructed_wake.jlã®å®Ÿè£…
```

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹æˆæœç‰©

1. **æ›´æ–°ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
   - `src/plot_reconstructed_wake.jl` (äºŒé ˜åŸŸå®Ÿè£…)

2. **æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿**
   - `figures/recon_metrics.csv` (ç²¾åº¦è©•ä¾¡)
   - `figures/wake_two_region_*.png` (å¯è¦–åŒ–)
   - `figures/extrapolation/*.png` (å¤–æŒ¿ãƒ†ã‚¹ãƒˆ)

3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
   - æ›´æ–°ã•ã‚ŒãŸ `JensenBastankhah_Plan.md`
   - æ›´æ–°ã•ã‚ŒãŸ `CHANGELOG.md`

4. **Gitã‚³ãƒŸãƒƒãƒˆ**
   - "Phase 3: Two-region wake reconstruction"

---

**æœ€çµ‚æ›´æ–°**: 2025-01-18
**æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³**: ãƒ•ã‚§ãƒ¼ã‚º3 - äºŒé ˜åŸŸé€Ÿåº¦å ´å†æ§‹æˆã®å®Ÿè£…
